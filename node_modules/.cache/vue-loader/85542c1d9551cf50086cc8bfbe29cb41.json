{"remainingRequest":"D:\\developer\\www\\vue-blog-index\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\developer\\www\\vue-blog-index\\src\\modules\\index\\page\\detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\developer\\www\\vue-blog-index\\src\\modules\\index\\page\\detail.vue","mtime":1584589959526},{"path":"D:\\developer\\www\\vue-blog-index\\node_modules\\babel-loader\\lib\\index.js","mtime":1565229057131},{"path":"D:\\developer\\www\\vue-blog-index\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1555406884439},{"path":"D:\\developer\\www\\vue-blog-index\\node_modules\\vue-loader\\lib\\index.js","mtime":1584631609333}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {mapGetters} from \"vuex\"\r\nimport marked from 'marked'\r\nimport 'style/message.styl'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      text_loading: true,\r\n      show: true,\r\n      loading: true,\r\n      checked: true,\r\n      hasclick: false,\r\n      detail: [],\r\n      commentList: [],\r\n      prevArticle: {},\r\n      nextrAticle: {},\r\n      comment: {\r\n        content: '',\r\n        name: '',\r\n        article_id: ''\r\n      },\r\n      pageModel: {\r\n        page: 1,\r\n        sumCount: 10\r\n      },\r\n      page: 2,\r\n      hasMore: true,\r\n      href: ''\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters([\r\n        'user'\r\n    ]),\r\n    compiledMarkdown: function () {\r\n      return marked(this.detail.content, { sanitize: false })\r\n    }\r\n  },\r\n  created() {\r\n    this.href = window.location.href\r\n    this.getDetail()\r\n  },\r\n  watch:{\r\n    $route(to,from){\r\n      this.getDetail()\r\n    }\r\n  },\r\n  methods: {\r\n    getDetail() {\r\n      this.$post('/api/v2/article', this.$route.params).then(res => {\r\n        this.text_loading = false\r\n        this.detail = res.data\r\n        this.detail.created_at = this.detail.created_at.substring(0,10).replace(/-/g,\"/\")\r\n        this.comment.article_id = this.detail.id\r\n        this.prevArticle = res.data.prevArticle[0]\r\n        this.nextrAticle = res.data.nextrAticle[0]\r\n\r\n        // 有评论是才请求这个接口\r\n        if (this.detail.comment){\r\n          this.getComment()\r\n        }\r\n      }).catch(() => {})\r\n    },\r\n    // 跳转上下一篇文章\r\n    goArticle(article) {\r\n      if(article) {\r\n        this.text_loading = true\r\n        this.$router.push(`/blog/${article.id}`)\r\n        this.hasclick = false\r\n      }\r\n    },\r\n    // 点赞\r\n    giveLike() {\r\n      let param = {\r\n        id: this.detail.id\r\n      }\r\n      if (!this.hasclick) {\r\n        this.$post('/api/v2/article/like', param).then(res => {\r\n          this.detail.like +=1\r\n          this.hasclick = true\r\n        }).catch(() => {})\r\n      }\r\n    },\r\n    // 获取评论\r\n    getComment() {\r\n      let param = {\r\n        article_id: this.detail.id,\r\n        ...this.pageModel,\r\n      }\r\n      this.$post('/api/v2/comment/read', param).then(res => {\r\n        this.commentList = res.data.data\r\n        this.pageModel.sumCount = res.data.total\r\n\r\n        this.commentList.forEach(item => {\r\n          item.content = marked(item.content, { sanitize: false })\r\n        })\r\n        this.loading = false\r\n      }).catch(() => {})\r\n    },\r\n    // 提交评论\r\n    submitComment() {\r\n      this.$post('/api/v2/comment/add', this.comment).then(res => {\r\n        this.comment.content = ''\r\n        this.detail.comment += 1\r\n        this.$Message.success(res.message)\r\n        this.getComment()\r\n      }).catch(() => {})\r\n    },\r\n    // 评论分页\r\n    selectRoleList() {\r\n      this.getComment()\r\n    },\r\n    // 删除自己的留言\r\n    deleteComment(item) {\r\n      this.$post('/api/v2/comment/delete', {id: item.id}).then(res => {\r\n        this.commentList.splice(this.commentList.indexOf(item), 1)\r\n        this.$Message.success(res.message)\r\n        this.detail.comment -= 1\r\n      }).catch(() => {})\r\n    }\r\n  }\r\n}\r\n",null]}